#!/bin/sh

sleep 20  # –ø–æ–¥–æ–∂–¥–∞—Ç—å –ø–æ–∫–∞ —Å–µ—Ç—å –∏ —Å–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è

logger -t passwall-init "‚¨áÔ∏è –°–∫–∞—á–∏–≤–∞–µ–º xray-core..."
mkdir -p /tmp/xray
wget -O /tmp/xray-core.ipk "https://github.com/elagor1996/xray_file/raw/main/passwall/xray-core_25.6.8-1_mipsel_24kc.ipk"

logger -t passwall-init "üì¶ –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º xray-core..."
tar -xzf /tmp/xray-core.ipk -C /tmp
tar -xzf /tmp/data.tar.gz -C /tmp/xray
chmod +x /tmp/xray/usr/bin/xray

# –£–¥–∞–ª—è–µ–º —Å–∫–∞—á–∞–Ω–Ω—ã–µ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∞—Ä—Ö–∏–≤—ã
rm -f /tmp/xray-core.ipk /tmp/data.tar.gz

logger -t passwall-init "‚úÖ –í–∫–ª—é—á–∞–µ–º Passwall..."
uci set passwall.@global[0].enabled='1'
uci commit passwall
/etc/init.d/passwall restart

logger -t passwall-init "‚úÖ Xray —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ Passwall –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω"